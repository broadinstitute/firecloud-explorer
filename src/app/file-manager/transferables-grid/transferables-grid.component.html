<ngx-spinner #spin bdOpacity="0.6" bdColor="#fff" size="medium" color="#1e88e5" type="ball-circus" style="z-index:10000"></ngx-spinner>

<h1>Progress Status</h1>
<div class="flex-container space-between">
  <div class="status-box">
    <h4 class="subtitle medium">Downloaded:</h4>
    <div class="flex-container space-between">
      <p class="aclaration">{{ downCompleted + ' of ' + downTotal }} file(s)</p>
      <h4 class="subtitle light">{{ downProgress | number:'1.0-0' }}%</h4>
    </div>

    <p-progressBar mode="determinate" class="progress-bar" [ngClass]="{'success': downProgress === 100, 'failure': downloadCanceled}"
      [value]="downProgress" [showValue]="false"></p-progressBar>

    <div class="flex-container end actions">
      <button mat-raised-button (click)="cancelDownloads()" class="button-secondary" [disabled]="!downloadInProgress">
        <i class="material-icons">highlight_off</i>Cancel Download
      </button>
      <!-- <button mat-raised-button (click)="resumeSelected()" class="button-primary">
        <i class="material-icons">pause_circle_outline</i>Pause all</button> -->
    </div>
  </div>

  <div class="status-box">
    <h4 class="subtitle medium">Uploaded:</h4>
    <div class="flex-container space-between">
      <p class="aclaration">{{ upCompleted + ' of ' + upTotal }} file(s)</p>
      <h4 class="subtitle light">{{ upProgress | number:'1.0-0' }}%</h4>
    </div>

    <p-progressBar mode="determinate" class="progress-bar" [ngClass]="{'success': upProgress === 100, 'failure': uploadCanceled}"
      [value]="upProgress" [showValue]="false"></p-progressBar>

    <div class="flex-container end actions">
      <button mat-raised-button (click)="cancelUploads()" class="button-secondary" [disabled]="!uploadInProgress">
        <i class="material-icons">highlight_off</i>Cancel Upload
      </button>
    </div>
  </div>

  <div class="status-box">
    <h4 class="subtitle medium">Exported to Google Cloud:</h4>
    <div class="flex-container space-between">

      <p class="aclaration">{{ filesDatabase.exportedToGCSCount() + ' of ' + filesDatabase.toExportGCSCount() }} file(s)</p>
      <h4 class="subtitle light">{{ gcsProgress | number:'1.0-0' }}%</h4>
    </div>

    <p-progressBar #pbg mode="determinate" class="progress-bar" [ngClass]="{'success': gcsProgress === 100, 'failure': exportToGCPCanceled === true}"
      [value]="gcsProgress" [showValue]="false"></p-progressBar>

    <div class="flex-container end actions">
      <button mat-raised-button (click)="cancelExportsToGCP()" class="button-secondary" [disabled]="!getExportingStatus()">
        <i class="material-icons">highlight_off</i>Cancel Export
      </button>
    </div>
  </div>

  <div class="status-box">
    <h4 class="subtitle medium">Exported to Amazon:</h4>
    <div class="flex-container space-between">
      <p class="aclaration">{{ s3Completed + ' of ' + s3Total }} file(s)</p>
      <h4 class="subtitle light">{{ s3Progress | number:'1.0-0' }}%</h4>
    </div>

    <p-progressBar mode="determinate" class="progress-bar" [ngClass]="{'success': s3Progress === 100, 'failure': exportToS3Canceled === true}"
      [value]="s3Progress" [showValue]="false"></p-progressBar>

    <div class="flex-container end actions">
      <button mat-raised-button (click)="cancelExportsToS3()" class="button-secondary" [disabled]="!(exportToS3InProgress && exportToS3Canceled === false)">
        <i class="material-icons">highlight_off</i>Cancel Export
      </button>
    </div>
  </div>
</div>

<mat-tab-group>

  <mat-tab label="Downloads">
    <fc-progress-tab source="Down">
    </fc-progress-tab>
  </mat-tab>

  <mat-tab  label="Uploads">
    <fc-progress-tab source="Up">
    </fc-progress-tab>
  </mat-tab>

  <mat-tab  label="Exports to GCS">
    <fc-progress-tab source="GCS">
    </fc-progress-tab>
  </mat-tab>

  <mat-tab  label="Exports to Amazon S3">
    <fc-progress-tab source="S3">
    </fc-progress-tab>
  </mat-tab>

</mat-tab-group>


<!-- <mat-expansion-panel #expa class="expand-panel">
  <mat-form-field class="search-container">
    <input matInput (keyup)="applyFilter($event.target.value)" placeholder="Search...">
  </mat-form-field>

  <mat-expansion-panel-header collapsedHeight="60px" expandedHeight="60px">
    <mat-panel-title>
      <mat-icon>{{expa.expanded ? 'keyboard_arrow_up' : 'keyboard_arrow_down' }}</mat-icon>
      {{ expa.expanded ? 'Hide detailed transfer list' : 'Show detailed transfer list'}}
    </mat-panel-title>
  </mat-expansion-panel-header>

  <div class="table-container flex-container column table-common">
    <mat-table #table [dataSource]="dataSource" matSort>
      <ng-container matColumnDef="id">
        <mat-header-cell *matHeaderCellDef mat-sort-header> Id</mat-header-cell>
        <mat-cell *matCellDef="let row"> {{row.id}}</mat-cell>
      </ng-container>

      <ng-container matColumnDef="name">
        <mat-header-cell *matHeaderCellDef mat-sort-header style="flex: 0 0 40%;"> Name</mat-header-cell>
        <mat-cell *matCellDef="let row" style="flex: 0 0 40%;" title="{{row.displayName}}"> {{row.displayName}}
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="size">
        <mat-header-cell *matHeaderCellDef mat-sort-header> Size</mat-header-cell>
        <mat-cell *matCellDef="let row"> {{row.size | filesize}}</mat-cell>
      </ng-container>

      <ng-container matColumnDef="status">
        <mat-header-cell *matHeaderCellDef mat-sort-header> Status</mat-header-cell>
        <mat-cell *matCellDef="let row">
          <mat-icon class="transfer-icon" *ngIf="row.type == 'Download'">file_download</mat-icon>
          <mat-icon class="transfer-icon" *ngIf="row.type == 'Upload'">file_upload</mat-icon>
          <i class="export-icon-dark" *ngIf="row.type == 'Export GCP' || row.type == 'Export S3' "></i>
          {{row.status}}
          <div *ngIf="row.status === 'Downloading' || row.status === 'Uploading' || row.status === 'Exporting to Google Cloud' || row.status === 'Exporting to Amazon'"
            class="progress-dots transfer-status">
            <span class="dot"></span>
            <span class="dot"></span>
            <span class="dot"></span>
          </div>
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="progress">
        <mat-header-cell *matHeaderCellDef> Progress</mat-header-cell>
        <mat-cell *matCellDef="let row">
          <p-progressBar *ngIf="row.status === 'Pending' || row.status === 'Downloading' || row.status === 'Uploading' || row.status === 'Completed' || row.status === 'Canceled'"
            mode="determinate" class="progress-bar-small" [ngClass]="{'success': row.status === 'Completed', 'failure': row.status === 'Canceled'}"
            [value]=row.progress [showValue]="false"></p-progressBar>
          <p-progressBar *ngIf="row.status === 'Exporting to Google Cloud' || row.status === 'Exporting to Amazon'" mode="indeterminate"
            class="progress-bar-small" [ngClass]="{'success': row.status === 'Completed', 'failure': row.status === 'Canceled'}"
            [showValue]="false"></p-progressBar>
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="actions">
        <mat-header-cell *matHeaderCellDef style="flex: 0 0 85px; text-align: center;"> Actions</mat-header-cell>
        <mat-cell *matCellDef="let row" style="flex: 0 0 85px;">
          <button mat-icon-button class="button-icon" disabled>
            <mat-icon aria-label="Cancel file download">highlight_off</mat-icon>
          </button>
          <button mat-icon-button class="button-icon" disabled>
            <mat-icon aria-label="Pause file download">pause_circle_outline</mat-icon>
          </button>
        </mat-cell>
      </ng-container>

      <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
      <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
    </mat-table>

    <mat-paginator #paginator [length]="filesDatabase.data().length" [pageIndex]="0" [pageSize]="10" [pageSizeOptions]="[5, 10, 25, 50, 100]"
      class="paginator"></mat-paginator>
  </div>
</mat-expansion-panel> -->